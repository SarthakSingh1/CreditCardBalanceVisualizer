<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Credit Card Payoff Calculator</title>
  <link rel="stylesheet" href="../public/css/styles.css">
</head>
<body>
  <div class="container">
    <h1>Credit Card Payoff Calculator</h1>
    <form id="calculator-form" class="input-form">
      <!-- First input for total balance of credit card -->
      <div class="form-group">
        <label for="totalBalance">Total Balance of Credit Card:</label>
        <input type="number" id="totalBalance" name="totalBalance" placeholder="Enter Total Balance" step="0.01" value="1000" required>
      </div>
      
      <!-- Second input for APR -->
      <div class="form-group">
        <label for="apr">APR (Annual Percentage Rate):</label>
        <input type="number" id="apr" name="apr" placeholder="Enter APR" step="0.01" min="0" value="15" required>
      </div>
      
      <!-- Third input for max monthly payment -->
      <div class="form-group">
        <label for="maxMonthlyPayment">Max Monthly Payment:</label>
        <input type="number" id="maxMonthlyPayment" name="maxMonthlyPayment" placeholder="Enter Max Monthly Payment" step="0.01" value="100" required>
      </div>
      
      <!-- Fourth input for extra monthly spend -->
      <div class="form-group">
        <label for="extraMonthlySpend">Extra Monthly Spend:</label>
        <input type="number" id="extraMonthlySpend" name="extraMonthlySpend" placeholder="Enter Extra Monthly Spend" step="0.01" value="0" required>
      </div>
      
      <button type="submit">Calculate</button>
    </form>
  </div>

  <div id="chart-container" class="chart-container">
    <canvas id="myChart" width="800" height="400"></canvas>
  </div>

  <!-- Script for Chart.js and your custom JavaScript code -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
  const form = document.getElementById('calculator-form');
  const ctx = document.getElementById('myChart').getContext('2d');
  let myChart; // Define myChart variable outside event listener

  form.addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent default form submission

    // Serialize form data
    const formData = new FormData(form);
    const serializedForm = {};
    for (const [key, value] of formData.entries()) {
      serializedForm[key] = value;
    }

    // Send form data to server using AJAX request
    fetch('/calculate', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(serializedForm)
    })
    .then(response => response.json())
    .then(data => {
      // Destroy the existing chart instance if it exists
      if (myChart) {
        myChart.destroy();
      }

      // Create a new chart instance with updated data
      myChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.balanceOverTime.labels,
          datasets: [{
            label: 'Remaining Balance',
            data: data.balanceOverTime.data,
            fill: false,
            borderColor: 'rgb(75, 192, 192)',
            tension: 0.1
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    })
    .catch(error => console.error('Error:', error));
  });
});
  </script>
</body>
</html>
